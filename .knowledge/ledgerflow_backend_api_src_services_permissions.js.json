{"is_source_file": true, "format": "JavaScript", "description": "This file implements permission management functions for workspaces and projects in a collaborative platform, including role retrieval, role setting, permission listing, permission setting, and permission enforcement.", "external_files": ["../lib/prisma", "./workspaces"], "external_methods": ["requireWorkspaceRole"], "published": ["getWorkspaceRoles", "setWorkspaceRole", "getProjectPermissions", "setProjectPermission", "enforceProjectPermission"], "classes": [], "methods": [{"name": "getWorkspaceRoles(currentUserId, workspaceId)", "description": "Retrieves all members and their roles for a specified workspace; requires ADMIN level role.", "scope": "", "scopeKind": ""}, {"name": "setWorkspaceRole(currentUserId, workspaceId, { userId, role })", "description": "Updates a member's role within a workspace, with restrictions on changing OWNER roles.", "scope": "", "scopeKind": ""}, {"name": "getProjectPermissions(currentUserId, workspaceId, projectId)", "description": "Lists project-level permissions for users within a workspace, requiring workspace ADMIN+ or project canAdmin permission.", "scope": "", "scopeKind": ""}, {"name": "setProjectPermission(currentUserId, workspaceId, projectId, { userId, canRead, canWrite, canExecute, canAdmin })", "description": "Upserts permission flags for a user on a specific project, requiring ADMIN or canAdmin rights.", "scope": "", "scopeKind": ""}, {"name": "enforceProjectPermission(userId, workspaceId, projectId, required = 'read')", "description": "Utility to verify whether a user has sufficient permission (read/write/execute/admin) on a project, throwing an error if not.", "scope": "", "scopeKind": ""}], "calls": ["requireWorkspaceRole", "prisma.membership.findMany", "prisma.membership.findUnique", "prisma.membership.update", "prisma.project.findFirst", "prisma.permission.findUnique", "prisma.permission.findMany", "prisma.permission.upsert", "prisma.user.findUnique"], "search-terms": ["permissions management", "workspace role functions", "project permission functions", "setWorkspaceRole", "setProjectPermission", "enforceProjectPermission"], "state": 2, "file_id": 26, "knowledge_revision": 64, "git_revision": "", "ctags": [{"_type": "tag", "name": "ADMIN", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^  ADMIN: 4,$/", "language": "JavaScript", "kind": "property", "scope": "ROLE_ORDER", "scopeKind": "class"}, {"_type": "tag", "name": "DEVELOPER", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^  DEVELOPER: 2,$/", "language": "JavaScript", "kind": "property", "scope": "ROLE_ORDER", "scopeKind": "class"}, {"_type": "tag", "name": "MAINTAINER", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^  MAINTAINER: 3,$/", "language": "JavaScript", "kind": "property", "scope": "ROLE_ORDER", "scopeKind": "class"}, {"_type": "tag", "name": "OWNER", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^  OWNER: 5,$/", "language": "JavaScript", "kind": "property", "scope": "ROLE_ORDER", "scopeKind": "class"}, {"_type": "tag", "name": "ROLE_ORDER", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^const ROLE_ORDER = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "VIEWER", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^  VIEWER: 1,$/", "language": "JavaScript", "kind": "property", "scope": "ROLE_ORDER", "scopeKind": "class"}, {"_type": "tag", "name": "admin", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^    admin: (p) => p?.canAdmin === true,$/", "language": "JavaScript", "kind": "property", "scope": "enforceProjectPermission.checks", "scopeKind": "class"}, {"_type": "tag", "name": "checks", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^  const checks = {$/", "language": "JavaScript", "kind": "class", "scope": "enforceProjectPermission", "scopeKind": "class"}, {"_type": "tag", "name": "enforceProjectPermission", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^async function enforceProjectPermission(userId, workspaceId, projectId, required = 'read') {$/", "language": "JavaScript", "kind": "function", "signature": "(userId, workspaceId, projectId, required = 'read')"}, {"_type": "tag", "name": "execute", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^    execute: (p) => p?.canExecute === true || p?.canAdmin === true,$/", "language": "JavaScript", "kind": "property", "scope": "enforceProjectPermission.checks", "scopeKind": "class"}, {"_type": "tag", "name": "getProjectPermissions", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^async function getProjectPermissions(currentUserId, workspaceId, projectId) {$/", "language": "JavaScript", "kind": "function", "signature": "(currentUserId, workspaceId, projectId)"}, {"_type": "tag", "name": "getWorkspaceRoles", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^  getWorkspaceRoles,$/", "language": "JavaScript", "kind": "field", "scope": "module.exports", "scopeKind": "class"}, {"_type": "tag", "name": "getWorkspaceRoles", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^async function getWorkspaceRoles(currentUserId, workspaceId) {$/", "language": "JavaScript", "kind": "function", "signature": "(currentUserId, workspaceId)"}, {"_type": "tag", "name": "prisma", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^const prisma = require('..\\/lib\\/prisma');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "read", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^    read: (p) => p?.canRead === true || p?.canAdmin === true,$/", "language": "JavaScript", "kind": "property", "scope": "enforceProjectPermission.checks", "scopeKind": "class"}, {"_type": "tag", "name": "setProjectPermission", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^async function setProjectPermission(currentUserId, workspaceId, projectId, { userId, canRead, ca/", "language": "JavaScript", "kind": "function", "signature": "(currentUserId, workspaceId, projectId, { userId, canRead, canWrite, canExecute, canAdmin })"}, {"_type": "tag", "name": "setWorkspaceRole", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^async function setWorkspaceRole(currentUserId, workspaceId, { userId, role }) {$/", "language": "JavaScript", "kind": "function", "signature": "(currentUserId, workspaceId, { userId, role })"}, {"_type": "tag", "name": "write", "path": "/home/kavia/workspace/code-generation/ledgerflow-unified-platform-809-1075/ledgerflow_backend_api/src/services/permissions.js", "pattern": "/^    write: (p) => p?.canWrite === true || p?.canAdmin === true,$/", "language": "JavaScript", "kind": "property", "scope": "enforceProjectPermission.checks", "scopeKind": "class"}], "hash": "6efbdd68e1e3cad6f137e9d30543648a", "format-version": 4, "code-base-name": "ledgerflow_backend_api", "filename": "ledgerflow_backend_api/src/services/permissions.js", "fields": [{"name": "ADMIN: 4,", "scope": "ROLE_ORDER", "scopeKind": "class", "description": "unavailable"}, {"name": "DEVELOPER: 2,", "scope": "ROLE_ORDER", "scopeKind": "class", "description": "unavailable"}, {"name": "MAINTAINER: 3,", "scope": "ROLE_ORDER", "scopeKind": "class", "description": "unavailable"}, {"name": "OWNER: 5,", "scope": "ROLE_ORDER", "scopeKind": "class", "description": "unavailable"}, {"name": "VIEWER: 1,", "scope": "ROLE_ORDER", "scopeKind": "class", "description": "unavailable"}, {"name": "admin: (p) => p?.canAdmin === true,", "scope": "enforceProjectPermission.checks", "scopeKind": "class", "description": "unavailable"}, {"name": "execute: (p) => p?.canExecute === true || p?.canAdmin === true,", "scope": "enforceProjectPermission.checks", "scopeKind": "class", "description": "unavailable"}, {"name": "getWorkspaceRoles,", "scope": "module.exports", "scopeKind": "class", "description": "unavailable"}, {"name": "read: (p) => p?.canRead === true || p?.canAdmin === true,", "scope": "enforceProjectPermission.checks", "scopeKind": "class", "description": "unavailable"}, {"name": "write: (p) => p?.canWrite === true || p?.canAdmin === true,", "scope": "enforceProjectPermission.checks", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"64": ""}]}